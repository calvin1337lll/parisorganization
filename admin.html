<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لوحة الإدارة | PARIS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --gold: #f1d279; --dark: #000; }
        body { background: var(--dark); color: white; font-family: 'Cairo', sans-serif; padding: 20px; }
        .admin-wrapper { max-width: 600px; margin: 50px auto; }
        .admin-box { 
            background: #0a0a0a; padding: 30px; border-radius: 20px; 
            border: 1px solid #1a1a1a; margin-bottom: 25px;
            position: relative; border-top: 3px solid var(--gold);
        }
        .admin-box::before, .admin-box::after {
            content: ''; position: absolute; width: 20px; height: 20px; border: 2px solid var(--gold);
        }
        .admin-box::before { top: 10px; right: 10px; border-bottom: 0; border-left: 0; }
        .admin-box::after { bottom: 10px; left: 10px; border-top: 0; border-right: 0; }
        h2 { color: var(--gold); text-align: center; margin-bottom: 20px; }
        input, textarea, select { 
            width: 100%; padding: 12px; margin: 10px 0; background: #000; 
            border: 1px solid #333; color: white; border-radius: 10px; text-align: center;
        }
        button { 
            width: 100%; padding: 12px; background: var(--gold); color: black; 
            font-weight: bold; border: none; border-radius: 10px; cursor: pointer;
        }
        #ownerOnly { display: none; border-top-color: #ff4757; }
    </style>
</head>
<body>

    <div class="admin-wrapper">
        <div class="admin-box">
            <h2><i class="fas fa-edit"></i> نظام النشر الموحد</h2>
            <select id="pubType">
                <option value="news">الصحيفة (الأخبار)</option>
                <option value="market">المتجر (المنتجات)</option>
                <option value="bank">البنك المركزي (بيانات مالية)</option> <option value="prison">السجن (قائمة السجناء)</option>
                <option value="court">المحكمة (الأحكام)</option>
                <option value="notifications">تنبيه عام (الشاشة الرئيسية)</option>
            </select>
            <input type="text" id="pTitle" placeholder="العنوان">
            <textarea id="pBody" placeholder="التفاصيل..." rows="3"></textarea>
            <input type="text" id="pImg" placeholder="رابط الصورة (اختياري)">
            <button onclick="publishData()">نشر الآن</button>
        </div>

        <div id="ownerOnly" class="admin-box">
            <h2 style="color: #ff4757;"><i class="fas fa-crown"></i> إدارة الرتب</h2>
            <input type="text" id="searchUser" placeholder="اسم المستخدم">
            <button onclick="manageRank('ADMIN')">ترقية لآدمن</button>
            <button onclick="manageRank('USER')" style="background:#ff4757; color:white; margin-top:5px;">تنزيل لمواطن</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { apiKey: "AIzaSyCQ-8xDBbTDugkwdJMT6BbnaW5aQxufbf4", databaseURL: "https://webparis-ef921-default-rtdb.firebaseio.com" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const session = JSON.parse(localStorage.getItem('paris_session'));
        if(session && session.rank === 'OWNER') document.getElementById('ownerOnly').style.display = 'block';

        window.publishData = async () => {
            const type = document.getElementById('pubType').value;
            const data = {
                title: document.getElementById('pTitle').value,
                body: document.getElementById('pBody').value,
                message: document.getElementById('pBody').value,
                image: document.getElementById('pImg').value,
                time: new Date().toLocaleString('ar-EG')
            };
            await push(ref(db, type), data);
            alert("تم النشر في قسم " + type);
        };

        window.manageRank = async (newRank) => {
            const targetName = document.getElementById('searchUser').value;
            const snap = await get(ref(db, 'users'));
            let foundKey = null;
            snap.forEach(u => { if(u.val().user === targetName) foundKey = u.key; });
            if(foundKey) {
                await update(ref(db, `users/${foundKey}`), { rank: newRank });
                alert("تم التحديث!");
            } else alert("غير موجود");
        };
    </script>
</body>
</html>
